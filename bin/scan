#!/bin/bash

ignored=(
    # TODO medium priority: djangorestframework
    # XXX: This is... unfortunately not present in safety's db right now. It is in synk though:
    # https://snyk.io/vuln/SNYK-PYTHON-DJANGORESTFRAMEWORK-450194
    # XSS in drf < 3.9.1. We could also probably backport this as we're quite a few minors behind.

    # TODO low priority: pyyaml
    # Arbitrary code execution in full_load/SafeLoader - doesn't apply to us.
    38100
)

# Take additional ignores from argv.
# This enables script re-use in getsentry
if [ $# -ge 1 ]; then
    for i in "$@"; do
        ignored+=("$i")
    done
fi

args="--full-report"
for i in ${ignored[@]}; do
  args="$args --ignore=${i}"
done

exec safety check ${args}
